#!/bin/bash
source /var/vcap/jobs/tests/lib/functions etcd

addKeyVals() {
	echo "Putting three keys..."
	./etcdctl --endpoints=http://$TARGET:2379 put foo bar
	./etcdctl --endpoints=http://$TARGET:2379 put pokemon psyduck
	./etcdctl --endpoints=http://$TARGET:2379 put avengers endgame
	echo ""
}

verifyVals() {
	if [[ $(./etcdctl --endpoints=http://$TARGET:2379 get foo --print-value-only) != "bar" ]]; then
		echo "!! foo key was not initialized properly"
	else
		echo "Got correct value for key foo"
	fi

	if [[ $(./etcdctl --endpoints=http://$TARGET:2379 get pokemon --print-value-only) != "psyduck" ]]; then
		echo "!! pokemon key was not initialized properly"
	else
		echo "Got correct value for key pokemon"
	fi

	if [[ $(./etcdctl --endpoints=http://$TARGET:2379 get avengers --print-value-only) != "endgame" ]]; then
		echo "!! avengers key was not initialized properly"
	else
		echo "Got correct value for key avengers"
	fi
}

runTests() {
	cd /var/vcap/packages/etcd/bin/
	export ETCDCTL_API=3

	echo -e "Setting up test data\n"
	addKeyVals

	echo "Verifying test data"
	verifyVals
}

runTests